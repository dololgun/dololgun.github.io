# 엔티티 매니저 팩토리

persitence.createEntityManagerFactory("jpabook");

위의 코드로 생성하고, 생성될 때  
META-INF/persistence.xml 에 정의되어 있는 설정정보를 참조한다.

emf가 생설될때 JAP와 관련된 객체가 동시에 생성되고 데이터베이스 컨넥션 풀도 생성되기 때문에 emf를 생성하는 비용은 매우 크다고 할 수 있다. 따라서 emf는 전체 어플리케이션에서 딱 한번만 생성하고 공유해서 사용하는 것이 좋다.

## 엔티티 매니저 생성
emf를 통해서 EntityManager(이하 em)를 생성한다. 우리는 em을 가상의 데이터베이스라고 생각하면된다. em안에는 영속성 컨텍스트가 존재하고 영속성 컨텍스트에 entity object가 존재한다.

em은 여러스레드가 동시에 접근하면 동시성 문제가 생길 수 있으므로 각각 스레드에서 별도의 em을 생성하여 사용해야 한다.  

em은 데이터베이스 연결이 꼭 필요한 시점까지 데이터베이스 연결을 시도하지 않는다.
## jpql
jpql은 객체를 대상으로 질의하는 쿼리이다. 

## update sql
일반적으로 update sql은 entity의 모든 칼럼을 대상으로 update하는 것을 원칙으로 한다. 하지만 칼럼이 많은 경우 (약 30개 이상)는 변경할 필요가 없는 필드도 update하게 되므로 성능상에 문제가 생길수 있다. 이런 경우 다이나믹 update를 사용하여 변경된 필드만 update할 수 있다. 이것을 사용하기 위해 하이버네이트의 DynamicUpdate 어노테이션(클래스 어노테이션)을 사용한다.